{% extends "base.html" %}
{% block title %}Edit Task - To-Do App{% endblock %}

{% block content %}
<div class="edit-task-container">
    <div class="edit-task-box card">
        <div class="card-header">
            <h2><i class="fas fa-edit"></i> Edit Task</h2>
            <p class="text-muted mb-0">Update your task details</p>
        </div>
        
        <div class="card-body">
            <form method="POST" action="{{ url_for('tasks.edit_task', task_id=task.id) }}">
                <!-- Task Title -->
                <div class="form-group">
                    <label for="title">
                        <i class="fas fa-heading"></i> Task Title
                    </label>
                    <input 
                        type="text" 
                        name="title" 
                        id="title" 
                        class="form-control" 
                        value="{{ task.title }}"
                        placeholder="Enter task title"
                        required
                        autofocus
                        maxlength="200"
                    >
                    <small class="form-text text-muted">
                        Maximum 200 characters
                    </small>
                </div>

                <!-- Task Description -->
                <div class="form-group">
                    <label for="description">
                        <i class="fas fa-align-left"></i> Description (Optional)
                    </label>
                    <textarea 
                        name="description" 
                        id="description" 
                        class="form-control" 
                        rows="4"
                        placeholder="Add more details about this task..."
                    >{{ task.description or '' }}</textarea>
                    <small class="form-text text-muted">
                        Provide additional details or notes
                    </small>
                </div>

                <!-- Current Status Display -->
                <div class="form-group">
                    <label>
                        <i class="fas fa-info-circle"></i> Current Status
                    </label>
                    <div>
                        <span class="badge badge-{{ task.status|lower }} badge-lg">
                            {% if task.status == 'Pending' %}
                                <i class="fas fa-clock"></i>
                            {% elif task.status == 'Working' %}
                                <i class="fas fa-spinner"></i>
                            {% else %}
                                <i class="fas fa-check"></i>
                            {% endif %}
                            {{ task.status }}
                        </span>
                    </div>
                    <small class="form-text text-muted">
                        Use the toggle button on the main page to change status
                    </small>
                </div>

                <!-- Task Metadata -->
                {% if task.created_at %}
                <div class="form-group">
                    <label>
                        <i class="fas fa-calendar-alt"></i> Created
                    </label>
                    <p class="form-control-plaintext">
                        {{ task.created_at.strftime('%B %d, %Y at %I:%M %p') }}
                    </p>
                </div>
                {% endif %}

                {% if task.updated_at and task.updated_at != task.created_at %}
                <div class="form-group">
                    <label>
                        <i class="fas fa-clock"></i> Last Updated
                    </label>
                    <p class="form-control-plaintext">
                        {{ task.updated_at.strftime('%B %d, %Y at %I:%M %p') }}
                    </p>
                </div>
                {% endif %}

                <!-- Action Buttons -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <a href="{{ url_for('tasks.view_task') }}" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                    <form action="{{ url_for('tasks.delete_task', task_id=task.id) }}" 
                          method="POST" 
                          style="display: inline;"
                          onsubmit="return confirm('Are you sure you want to delete this task?');">
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Delete Task
                        </button>
                    </form>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .edit-task-container {
        max-width: 700px;
        margin: 0 auto;
    }
    
    .card-header h2 {
        margin-bottom: 5px;
        font-size: 24px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        font-weight: 600;
        margin-bottom: 8px;
        display: block;
        color: #333;
    }
    
    .form-group label i {
        margin-right: 5px;
        color: #666;
    }
    
    .badge-lg {
        padding: 8px 16px;
        font-size: 14px;
    }
    
    .badge-pending {
        background-color: #ffc107;
        color: #000;
    }
    
    .badge-working {
        background-color: #17a2b8;
        color: #fff;
    }
    
    .badge-done {
        background-color: #28a745;
        color: #fff;
    }
    
    .form-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #dee2e6;
    }
    
    .form-control-plaintext {
        padding: 0.375rem 0;
        margin-bottom: 0;
        color: #495057;
    }
    
    @media (max-width: 576px) {
        .form-actions {
            flex-direction: column;
        }
        
        .form-actions .btn {
            width: 100%;
        }
    }
</style>

<script>
    // Auto-resize textarea
    const textarea = document.getElementById('description');
    textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });
    
    // Character counter for title
    const titleInput = document.getElementById('title');
    titleInput.addEventListener('input', function() {
        const remaining = 200 - this.value.length;
        const parent = this.parentElement;
        let counter = parent.querySelector('.char-counter');
        
        if (!counter) {
            counter = document.createElement('small');
            counter.className = 'char-counter form-text';
            counter.style.float = 'right';
            parent.appendChild(counter);
        }
        
        counter.textContent = `${this.value.length}/200`;
        counter.style.color = remaining < 20 ? '#dc3545' : '#6c757d';
    });
</script>
{% endblock %}